#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>

const int LINE_SIZE = 1024;

typedef struct Person {
    int  age;
    double ga_ctg;
    double ga_b;
    char sex;
    double weight;
    double a1;
    double a5;

} Person;

char* getfield(char* line, int num)
{
    char* tok;
    for (tok = strtok(line, ";"); tok && *tok; tok = strtok(NULL, ";\n")){
        if (!--num)
            return tok;
    }
    return NULL;
}

int main(){
    FILE* file = fopen("FILEPATH", "r");
    char line[LINE_SIZE];

    Person* people;
    int count = 0;

    if (file == NULL) {
        perror("Error opening file");
        return -1;
    }

    //Count the number of columns to know how to allocate properly URGENT!!!
    char ch;
    int column_Number = 0;
    int line_Number = 0;

    while((ch=fgetc(file))!=EOF) {
        if(ch==';'){
            column_Number++;
            line_Number++;
        }
        if (ch == '\n')
            break;
    }
    printf("Number of columns: %d \n", column_Number + 1); //Plus one because the number of ; is -1 number of columns

    //

    while (fgets(line, LINE_SIZE, file)){count++;} // counts the number of lines in file

    // decreases count by one (since it will ignore first line of data)
    count--;

    if(count < 1) // no data
        return 0;

    // allocate memory for the age array
    people = (Person*)malloc(count * sizeof(Person));

    if (people == NULL) {
        perror("error allocating people array");
        exit(0);
    }

    rewind(file); // rewinds file

    fgets(line, LINE_SIZE, file); // reads first line (column names) and do nothing

    count = 0; // reset count to use it as array index
    while (fgets(line, LINE_SIZE, file))
    {
        char temp[LINE_SIZE];
        // Get every column of row as char*
        char* age = getfield(strcpy(temp, line), 1);
        char* ga_ctg = getfield(strcpy(temp, line), 2);
        char* ga_b = getfield(strcpy(temp, line), 3);
        char* sex = getfield(strcpy(temp, line), 4);
        char* weight = getfield(strcpy(temp, line), 5);
        char* a1 = getfield(strcpy(temp, line), 6);
        char* a5 = getfield(strcpy(temp, line), 7);
        // stores converted values in the person array
        people[count].age = atoi(age);
        people[count].ga_ctg = atof(ga_ctg);
        people[count].ga_b = atof(ga_b);
        people[count].sex = sex[0];
        people[count].weight = atof(weight);
        people[count].a1 = atof(a1);
        people[count].a5 = atof(a5);
        // -------------------------------------------

        count++;
    }

    // debugs array
    for (int i = 0; i < count; i++) {
        printf("age: %d | ga_ctg: %.2f | ga_b: %.2f | sex: %c | weight: %.2f | a1: %.2f | a5: %.2f\n",
               people[i].age, people[i].ga_ctg, people[i].ga_b, people[i].sex,
               people[i].weight, people[i].a1, people[i].a5);
    }

    //Sum all the elements inside the a1 array
    int j = 0;
    int sum = 0;
    for (j = 0; j < count; ++j){
        //The number of elements inside the array will be equal the number of lines - the title of the table

        sum += people[j].a1;
    }
    printf("\nThe sum of the elements inside the array a1 would be: %d?\n", sum);

    //Do the arithmetic mean of the elements from the array a1

    float me = 0;

    me = (float) sum/ count;

    printf("\nThe arithmetic mean would be: %f?\n",me);

    //

    //Find the greater value inside the a1 array
   int largest = people[0].a1;
   int position = 0;
   int loop;

   for (loop = 0; loop < count; loop++){
       if (people[loop].a1 > largest){
           largest = people[loop].a1 ;
           position = loop;
       }
   }
   printf("\nThe largest elements in the array a1 is: %d", largest);
   printf("\nIndex position of the Largest element = %d \n", position);
    //printf("The largest element is: %f ", people[33].a1 );


    //Find the lowest value inside the array a1

    int position1 = 0;
    int lowest = people[0].a1;
    int loo;

    for (loo = 0; loo < count; loo++){
        if (people[loo].a1 < lowest){
            lowest = people[loo].a1;
            position1 = loo;
        }
    }
    printf("\nThe lowest elements in the array a1 is: %d", lowest);
    printf("\nIndex position of the lowest element = %d", position1);


    //Variance
    /*int sum1;
    float variance;
      for (int p = 0; p < count; p++)
      {
          sum1 = sum1 + pow(((people[p].a1) - me), 2);
      }
    variance = sum1 / (float) count;
      printf("\nVariance would it be: %.2f\n", variance);

       //Median
    float median;
       if (count%2 == 0){
          median = (people[(count/2)-1].a1+people[(count/2)]).a1/2.0;
       }
       else{
          median = people[(count/2)].a1;
      }
      printf ("\nMedian of the array a1 is: %f", median);
    */

    //Write the results in a file













    fclose(file);
    free(people);

    return 0;
}

